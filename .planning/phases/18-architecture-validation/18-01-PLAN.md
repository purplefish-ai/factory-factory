---
phase: 18-architecture-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/backend/routers/websocket/snapshots.handler.ts
  - src/backend/routers/websocket/snapshots.handler.test.ts
  - .planning/REQUIREMENTS.md
  - .planning/ROADMAP.md
  - .planning/PROJECT.md
  - .planning/STATE.md
autonomous: true

must_haves:
  truths:
    - "pnpm check:imports reports zero violations"
    - "pnpm build completes successfully (production build)"
    - "pnpm test passes with zero regressions (2064+ tests)"
    - "pnpm deps:check reports zero violations across 18 rules"
    - "All 32 v1.1 requirements marked Done in REQUIREMENTS.md traceability table"
  artifacts:
    - path: "src/backend/routers/websocket/snapshots.handler.ts"
      provides: "Fixed import using @/backend/app-context alias"
      contains: "@/backend/app-context"
    - path: "src/backend/routers/websocket/snapshots.handler.test.ts"
      provides: "Fixed import and vi.mock path using @/backend/app-context alias"
      contains: "@/backend/app-context"
    - path: ".planning/REQUIREMENTS.md"
      provides: "All 32 requirements marked as Done"
      contains: "[x]"
  key_links:
    - from: "src/backend/routers/websocket/snapshots.handler.ts"
      to: "@/backend/app-context"
      via: "path alias import"
      pattern: "from '@/backend/app-context'"
    - from: "src/backend/routers/websocket/snapshots.handler.test.ts"
      to: "@/backend/app-context"
      via: "vi.mock path matching source import"
      pattern: "vi\\.mock\\('@/backend/app-context'"
---

<objective>
Fix the 3 parent-relative imports blocking production build, run the complete CI check sequence to validate all architecture rules pass with zero violations and zero test regressions, then update milestone documentation to reflect v1.1 completion.

Purpose: This is the final phase of the v1.1 Project Snapshot Service milestone. It validates that 230 files of changes across Phases 11-17 leave the codebase clean, buildable, and fully tested.
Output: Green CI check sequence, updated REQUIREMENTS.md (32/32 Done), updated ROADMAP.md (Phase 18 complete, v1.1 shipped).
</objective>

<execution_context>
@/Users/martin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/martin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/18-architecture-validation/18-RESEARCH.md
@src/backend/routers/websocket/snapshots.handler.ts
@src/backend/routers/websocket/snapshots.handler.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix parent-relative imports and run full CI validation</name>
  <files>
    src/backend/routers/websocket/snapshots.handler.ts
    src/backend/routers/websocket/snapshots.handler.test.ts
  </files>
  <action>
Fix the 3 parent-relative imports that block `pnpm build`:

1. In `src/backend/routers/websocket/snapshots.handler.ts` line 20:
   Change `import { type AppContext, createAppContext } from '../../app-context';`
   to `import { type AppContext, createAppContext } from '@/backend/app-context';`

2. In `src/backend/routers/websocket/snapshots.handler.test.ts` line 8:
   Change `import type { AppContext } from '../../app-context';`
   to `import type { AppContext } from '@/backend/app-context';`

3. In `src/backend/routers/websocket/snapshots.handler.test.ts` line 64:
   Change `vi.mock('../../app-context', () => ({`
   to `vi.mock('@/backend/app-context', () => ({`

These match the pattern used by all 6 sibling handler files in the same directory (chat.handler.ts, terminal.handler.ts, dev-logs.handler.ts, etc.).

After fixing, run the complete CI check sequence in order, capturing results:
```bash
pnpm check                                        # Biome lint
pnpm check:imports                                 # Import style enforcement (was FAIL, should now PASS)
pnpm check:biome-ignores                           # Biome suppression budget
pnpm deps:check                                    # Architecture rules (18 rules, 736+ modules)
pnpm knip --include files,dependencies,unlisted    # Dead code
pnpm typecheck                                     # TypeScript strict mode
pnpm test                                          # Full test suite (2064+ tests)
pnpm build                                         # Production build (was FAIL, should now PASS)
```

Every check must pass. Record the results for the summary.
  </action>
  <verify>
All 8 CI checks pass:
- `pnpm check` exits 0
- `pnpm check:imports` exits 0 (was previously FAIL)
- `pnpm check:biome-ignores` exits 0
- `pnpm deps:check` exits 0 with 0 violations
- `pnpm knip --include files,dependencies,unlisted` exits 0
- `pnpm typecheck` exits 0
- `pnpm test` exits 0 with 2064+ tests passing
- `pnpm build` exits 0 (was previously FAIL)
  </verify>
  <done>Production build succeeds, all tests pass with zero regressions, all architecture rules enforced with zero violations. ARCH-03 and ARCH-04 requirements satisfied.</done>
</task>

<task type="auto">
  <name>Task 2: Update milestone documentation to reflect v1.1 completion</name>
  <files>
    .planning/REQUIREMENTS.md
    .planning/ROADMAP.md
    .planning/PROJECT.md
    .planning/STATE.md
  </files>
  <action>
Update all milestone documentation to reflect v1.1 Project Snapshot Service completion:

1. **REQUIREMENTS.md** -- Update all 32 v1.1 requirement checkboxes and traceability:
   - Change all `- [ ]` to `- [x]` in the requirements lists (STORE-01 through ARCH-04)
   - Change all traceability table Status values from `Pending` to `Done`

2. **ROADMAP.md** -- Mark Phase 18 and v1.1 milestone complete:
   - Change Phase 18 checkbox from `- [ ]` to `- [x]`
   - Update Phase 18 details: add `Plans:` count as `1 plan`, update plan list with `- [x] 18-01-PLAN.md -- Fix imports, full CI validation, milestone documentation`
   - Update progress table: Phase 18 row to `1/1 | Complete | {today's date}`
   - Change milestone header from `In Progress` to `SHIPPED {today's date}`
   - Update `Last updated` footer

3. **PROJECT.md** -- Update Active requirements section:
   - Move the 6 active requirement bullet points from `### Active` to `### Validated` with appropriate descriptions
   - Mark the 4 key decisions with "Pending" outcome as validated (in-memory snapshot, event-driven + safety-net, WebSocket push, state-only agent status)
   - Update `Current Milestone` or add completion note

4. **STATE.md** -- Update position to reflect milestone completion:
   - Phase: 18 of 18 (Architecture Validation) -- Complete
   - Progress: 100%
   - Status: v1.1 milestone complete
   - Add Phase 18 to the velocity table
  </action>
  <verify>
- `grep -c '\- \[x\]' .planning/REQUIREMENTS.md` returns 32 (all requirements checked)
- `grep -c 'Pending' .planning/REQUIREMENTS.md` returns 0 in the traceability table
- `grep 'Phase 18' .planning/ROADMAP.md` shows completed status
- `grep 'SHIPPED' .planning/ROADMAP.md` shows v1.1 shipped
  </verify>
  <done>All 32 v1.1 requirements marked Done, ROADMAP shows Phase 18 complete and v1.1 milestone shipped, PROJECT.md reflects validated status, STATE.md shows 100% progress.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. No parent-relative imports remain in codebase: `pnpm check:imports` passes
2. Production build succeeds: `pnpm build` exits 0
3. Full test suite green: `pnpm test` shows 2064+ tests passing
4. Architecture rules enforced: `pnpm deps:check` shows 0 violations across 18 rules
5. All v1.1 documentation reflects completion
</verification>

<success_criteria>
1. `pnpm build` completes successfully (ARCH-03 satisfied)
2. `pnpm test` passes with 2064+ tests, zero regressions (ARCH-04 satisfied)
3. `pnpm deps:check` reports zero violations
4. All 32 v1.1 requirements marked Done in REQUIREMENTS.md
5. ROADMAP.md shows v1.1 milestone shipped
</success_criteria>

<output>
After completion, create `.planning/phases/18-architecture-validation/18-01-SUMMARY.md`
</output>
