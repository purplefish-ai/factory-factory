---
phase: 01-foundation-domain-scaffolding
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/backend/domains/session/index.ts
  - src/backend/domains/workspace/index.ts
  - src/backend/domains/github/index.ts
  - src/backend/domains/ratchet/index.ts
  - src/backend/domains/terminal/index.ts
  - src/backend/domains/run-script/index.ts
  - .dependency-cruiser.cjs
autonomous: true

must_haves:
  truths:
    - "All 6 domain directories exist under src/backend/domains/"
    - "Each domain has a barrel file (index.ts) with domain header comment"
    - "Session domain barrel re-exports sessionDomainService"
    - "Cross-domain imports are flagged as errors by dependency-cruiser"
    - "pnpm typecheck passes with no new errors"
    - "pnpm deps:check passes with no violations"
  artifacts:
    - path: "src/backend/domains/session/index.ts"
      provides: "Session domain barrel file"
      contains: "sessionDomainService"
    - path: "src/backend/domains/workspace/index.ts"
      provides: "Workspace domain barrel placeholder"
      contains: "Domain: workspace"
    - path: "src/backend/domains/github/index.ts"
      provides: "GitHub domain barrel placeholder"
      contains: "Domain: github"
    - path: "src/backend/domains/ratchet/index.ts"
      provides: "Ratchet domain barrel placeholder"
      contains: "Domain: ratchet"
    - path: "src/backend/domains/terminal/index.ts"
      provides: "Terminal domain barrel placeholder"
      contains: "Domain: terminal"
    - path: "src/backend/domains/run-script/index.ts"
      provides: "Run-script domain barrel placeholder"
      contains: "Domain: run-script"
    - path: ".dependency-cruiser.cjs"
      provides: "Cross-domain import enforcement rule"
      contains: "no-cross-domain-imports"
  key_links:
    - from: ".dependency-cruiser.cjs"
      to: "src/backend/domains/*/"
      via: "regex group matching rule"
      pattern: "no-cross-domain-imports"
---

<objective>
Create the domain module directory structure and enforcement rules for the SRP refactor.

Purpose: Establish the scaffolding and guard rails that all subsequent domain consolidation phases (2-7) will target. By creating directories, barrel files, and a dependency-cruiser rule now, the project has a clear convention and automated enforcement from day one.

Output: 6 domain directories with barrel files, 1 new dependency-cruiser rule, all checks passing.
</objective>

<execution_context>
@/Users/martin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/martin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-domain-scaffolding/01-RESEARCH.md
@.dependency-cruiser.cjs
@src/backend/domains/session/session-domain.service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create domain directories and barrel files</name>
  <files>
    src/backend/domains/session/index.ts
    src/backend/domains/workspace/index.ts
    src/backend/domains/github/index.ts
    src/backend/domains/ratchet/index.ts
    src/backend/domains/terminal/index.ts
    src/backend/domains/run-script/index.ts
  </files>
  <action>
Create 5 new domain directories and 6 barrel files (including one for the existing session domain).

**Session domain barrel file** (`src/backend/domains/session/index.ts`):
- Add header comment: `// Domain: session` and `// Public API for the session domain module.`
- Add comment: `// Consumers should import from '@/backend/domains/session' only.`
- Re-export the existing service: `export { sessionDomainService } from './session-domain.service';`
- Do NOT change any existing imports elsewhere -- existing consumers use full path `@/backend/domains/session/session-domain.service` and that still works. Phase 9 will update them to use the barrel.

**New domain barrel files** (workspace, github, ratchet, terminal, run-script):
- Create each directory: `src/backend/domains/{name}/`
- Create `index.ts` in each with header comment identifying the domain and referencing which phase will populate it:
  - workspace: `// Public API will be populated during Phase 3 (Workspace Domain Consolidation).`
  - github: `// Public API will be populated during Phase 4 (GitHub Domain Consolidation).`
  - ratchet: `// Public API will be populated during Phase 5 (Ratchet Domain Consolidation).`
  - terminal: `// Public API will be populated during Phase 6 (Terminal Domain Consolidation).`
  - run-script: `// Public API will be populated during Phase 7 (Run Script Domain Consolidation).`
- Each placeholder barrel file should have an empty export to avoid "no exports" warnings: `export {};`

Run `pnpm check:fix` after creating all files to ensure Biome formatting compliance.
  </action>
  <verify>
Verify all 6 barrel files exist:
```bash
ls src/backend/domains/session/index.ts \
   src/backend/domains/workspace/index.ts \
   src/backend/domains/github/index.ts \
   src/backend/domains/ratchet/index.ts \
   src/backend/domains/terminal/index.ts \
   src/backend/domains/run-script/index.ts
```
Verify `pnpm typecheck` passes (no type errors introduced).
  </verify>
  <done>All 6 domain directories exist with barrel files. Session barrel re-exports sessionDomainService. New domain barrels are placeholders with domain header and empty export. pnpm typecheck passes.</done>
</task>

<task type="auto">
  <name>Task 2: Add dependency-cruiser cross-domain import rule</name>
  <files>.dependency-cruiser.cjs</files>
  <action>
Add a new rule to the `forbidden` array in `.dependency-cruiser.cjs` that prevents any domain module from importing from a sibling domain module. Use regex group matching (`$1` capture) so the rule scales automatically as domains are added.

**Rule to add** (insert after the existing `only-session-domain-imports-session-store` rule):
```javascript
{
  name: "no-cross-domain-imports",
  severity: "error",
  comment:
    "Domain modules must not import from sibling domains directly. " +
    "Cross-domain coordination goes through the orchestration layer (Phase 8).",
  from: { path: "^src/backend/domains/([^/]+)/" },
  to: {
    path: "^src/backend/domains/([^/]+)/",
    pathNot: "^src/backend/domains/$1/",
  },
},
```

Key details:
- The `from.path` captures the domain name as group `$1`
- The `to.pathNot` excludes imports within the SAME domain (matching `$1`)
- Only cross-domain imports are flagged as errors
- Do NOT add test file exclusions yet (per research recommendation: start strict, relax later if needed)
- This rule currently has zero violations since no domain imports another domain yet

Run `pnpm check:fix` to format the updated file, then run `pnpm deps:check` to verify the rule is syntactically valid and no violations exist.
  </action>
  <verify>
Run `pnpm deps:check` and confirm it passes with 0 violations. The new rule should appear in the output. Also verify:
```bash
grep "no-cross-domain-imports" .dependency-cruiser.cjs
```
confirms the rule exists in the config file.
  </verify>
  <done>dependency-cruiser config has the new `no-cross-domain-imports` rule. `pnpm deps:check` passes with no violations. The rule uses group matching to automatically enforce boundaries for all current and future domains.</done>
</task>

</tasks>

<verification>
After both tasks complete, run the full verification suite:

1. `pnpm typecheck` -- confirms no type errors from new barrel files
2. `pnpm deps:check` -- confirms dependency-cruiser passes with the new rule (0 violations)
3. `pnpm check:fix` -- confirms all new files pass Biome formatting/linting
4. Verify directory structure:
```bash
find src/backend/domains -type f -name "*.ts" | sort
```
Expected output should include all 6 barrel files plus the existing session domain service and test files.
</verification>

<success_criteria>
- All 6 domain directories exist: session, workspace, github, ratchet, terminal, run-script
- Each has an index.ts barrel file with domain identification comment
- Session barrel exports sessionDomainService
- dependency-cruiser has `no-cross-domain-imports` rule using group matching
- `pnpm typecheck` passes
- `pnpm deps:check` passes with 0 violations
- `pnpm check:fix` produces no errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-domain-scaffolding/01-01-SUMMARY.md`
</output>
