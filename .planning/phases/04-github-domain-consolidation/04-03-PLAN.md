---
phase: 04-github-domain-consolidation
plan: 03
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified:
  - src/backend/domains/github/index.ts
  - src/backend/domains/github/github-domain-exports.test.ts
autonomous: true

must_haves:
  truths:
    - "All GitHub domain exports are accessible via single barrel import '@/backend/domains/github'"
    - "Every runtime export is a real value (not undefined from circular dependency breakage)"
    - "Full test suite passes including new smoke test"
  artifacts:
    - path: "src/backend/domains/github/index.ts"
      provides: "GitHub domain barrel with selective named exports"
      exports: ["githubCLIService", "GitHubCLIErrorType", "PRStatusFromGitHub", "PRInfo", "ReviewRequestedPR", "GitHubCLIHealthStatus", "GitHubIssue", "prSnapshotService", "PRSnapshotRefreshResult", "AttachAndRefreshResult", "prReviewFixerService", "ReviewCommentDetails", "PRReviewFixResult", "prReviewMonitorService"]
    - path: "src/backend/domains/github/github-domain-exports.test.ts"
      provides: "Smoke test verifying all runtime exports are defined"
  key_links:
    - from: "src/backend/domains/github/index.ts"
      to: "src/backend/domains/github/github-cli.service.ts"
      via: "selective re-export"
      pattern: "from './github-cli.service'"
    - from: "src/backend/domains/github/index.ts"
      to: "src/backend/domains/github/pr-snapshot.service.ts"
      via: "selective re-export"
      pattern: "from './pr-snapshot.service'"
    - from: "src/backend/domains/github/index.ts"
      to: "src/backend/domains/github/pr-review-fixer.service.ts"
      via: "selective re-export"
      pattern: "from './pr-review-fixer.service'"
    - from: "src/backend/domains/github/index.ts"
      to: "src/backend/domains/github/pr-review-monitor.service.ts"
      via: "selective re-export"
      pattern: "from './pr-review-monitor.service'"
---

<objective>
Populate the GitHub domain barrel file with selective named exports from all 4 domain modules, and create a smoke test verifying every runtime export is defined.

Purpose: Provide a single import point for the GitHub domain's public API. The smoke test catches circular dependency issues that could cause exports to be undefined at runtime.
Output: Populated barrel file + smoke test.
</objective>

<execution_context>
@/Users/martin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/martin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-github-domain-consolidation/04-01-SUMMARY.md
@.planning/phases/04-github-domain-consolidation/04-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Populate GitHub domain barrel with selective named exports</name>
  <files>src/backend/domains/github/index.ts</files>
  <action>
Replace the placeholder `export {}` in `src/backend/domains/github/index.ts` with selective named exports from all 4 domain modules. Follow the exact pattern from the workspace domain barrel (Phase 3 Plan 05).

Use named exports (not `export *`) per established convention:

```typescript
// Domain: github
// Public API for the GitHub domain module.
// Consumers should import from '@/backend/domains/github' only.

// --- GitHub CLI wrapper ---
export {
  type GitHubCLIErrorType,
  type GitHubCLIHealthStatus,
  type GitHubIssue,
  type PRInfo,
  type PRStatusFromGitHub,
  type ReviewRequestedPR,
  githubCLIService,
} from './github-cli.service';

// --- PR snapshot ---
export {
  type AttachAndRefreshResult,
  type PRSnapshotRefreshResult,
  prSnapshotService,
} from './pr-snapshot.service';

// --- PR review fixer ---
export {
  type PRReviewFixResult,
  type ReviewCommentDetails,
  prReviewFixerService,
} from './pr-review-fixer.service';

// --- PR review monitor ---
export { prReviewMonitorService } from './pr-review-monitor.service';
```

Note: Biome may auto-sort exports alphabetically by import path during pre-commit. This is expected behavior per established convention (03-05 decision). Section comments remain as landmarks.
  </action>
  <verify>
Run `pnpm typecheck` to confirm barrel resolves all exports without errors. Verify by checking that `import { githubCLIService } from '@/backend/domains/github'` would resolve correctly.
  </verify>
  <done>GitHub domain barrel exports 4 runtime values + 10 types from 4 source modules using selective named exports.</done>
</task>

<task type="auto">
  <name>Task 2: Create GitHub domain smoke test and run full verification</name>
  <files>src/backend/domains/github/github-domain-exports.test.ts</files>
  <action>
Create `src/backend/domains/github/github-domain-exports.test.ts` following the exact pattern from the workspace domain smoke test.

Use static imports (not dynamic `await import()` — Biome forbids it per 02-06 decision). Test that every runtime export from the barrel is defined and has the correct type (function for service singletons, function for class constructors).

```typescript
import { describe, expect, it } from 'vitest';
import {
  githubCLIService,
  prReviewFixerService,
  prReviewMonitorService,
  prSnapshotService,
} from './index';

/**
 * Domain barrel export smoke test.
 *
 * Verifies that every public runtime export from the GitHub domain barrel
 * is a real value (not `undefined` due to circular dependency breakage).
 * Static imports ensure the barrel can be loaded at module resolution time.
 */
describe('GitHub domain exports', () => {
  it('exports githubCLIService as an object', () => {
    expect(githubCLIService).toBeDefined();
  });

  it('exports prSnapshotService as an object', () => {
    expect(prSnapshotService).toBeDefined();
  });

  it('exports prReviewFixerService as an object', () => {
    expect(prReviewFixerService).toBeDefined();
  });

  it('exports prReviewMonitorService as an object', () => {
    expect(prReviewMonitorService).toBeDefined();
  });
});
```

After creating the test, run full verification:
1. `pnpm test -- --run src/backend/domains/github/github-domain-exports.test.ts` — smoke test passes
2. `pnpm test -- --run src/backend/domains/github/` — all domain tests pass
3. `pnpm typecheck` — no type errors
4. `pnpm test -- --run` — full suite passes (no regressions)
  </action>
  <verify>
Run `pnpm test -- --run src/backend/domains/github/` to confirm all domain tests pass (smoke test + github-cli tests + pr-snapshot tests). Run `pnpm typecheck` for clean compilation. Run `pnpm test -- --run` for full suite green.
  </verify>
  <done>Smoke test verifies all 4 runtime exports are defined. Full test suite passes. GitHub domain consolidation complete: GH-01, GH-02, GH-03 satisfied.</done>
</task>

</tasks>

<verification>
- `pnpm typecheck` passes with zero errors
- `pnpm test -- --run src/backend/domains/github/` runs smoke test + 2 co-located test files, all pass
- `pnpm test -- --run` full suite passes
- Barrel file at `src/backend/domains/github/index.ts` exports all 4 runtime values and 10 types
- All 4 source files live in `src/backend/domains/github/`
- Re-export shims at all 4 old `src/backend/services/` paths maintain backward compatibility

Phase 4 requirements check:
- GH-01: src/backend/domains/github/ owns all GitHub CLI interactions (PRs, issues, CI status) -- SATISFIED
- GH-02: PR snapshot and review monitoring consolidated under GitHub domain -- SATISFIED
- GH-03: GitHub domain has co-located unit tests covering its public API -- SATISFIED (smoke test + 2 existing test files)
</verification>

<success_criteria>
- GitHub domain barrel exports complete public API (4 runtime values, 10 types)
- Smoke test confirms no circular dependency breakage
- Full test suite passes with no regressions
- Phase 4 requirements GH-01, GH-02, GH-03 all satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/04-github-domain-consolidation/04-03-SUMMARY.md`
</output>
